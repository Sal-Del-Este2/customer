<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Clientes</title>

    <style>
      .form-container {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 20px;
        margin: 20px auto;
      }
      
      .form-container div {
        background-color: #f4f4f4;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 6px;
        width: 45%;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      /* tabla ver */
      table {
        width: 40%;
        border-collapse: collapse;
        margin-top: 20px;
        background-color: #90bdf8;
        border-radius: 4px;
        border: 1px solid #ccc;
        font-family: Arial, sans-serif;
        font-size: 13px;
        color: #333;
        overflow: hidden;
      }
      
      th, td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      
      th {
        background-color: #007bff;
        font-weight: bold;
        color: #ffffff;
      }
      
      tr:hover {
        background-color: #f1f1f1;
      }
      /* formulario */
      form {
        max-width: 400px;
        margin: 10px 0;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #90bdf8;
        font-family: Arial, sans-serif;
      }
    
      form label {
        display: block;
        margin-bottom: 20px;
        font-weight: bold;
        font-size: 15px;
      }
    
      form input {
        width: 90%;
        padding: 8px 10px;
        margin-top: 3px;
        border: 1px solid #43b0f8;
        border-radius: 4px;
        font-size: 13px;
      }
    
      form button {
        margin-top: 3px;
        padding: 10px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 13px;
        cursor: pointer;
      }
    
      form button:hover {
        background-color: #0056b3;
      }
    </style>

  </head>
  <body>
    <h1>Gestión de Clientes</h1>
    
    <div class="form-container">
      <div>
        <!-- ver a los clientes activos -->
        <h2>Ver todos los clientes</h2>
        <button onclick="getAllCustomers()">Ver Clientes</button>
        <table border="1" id="customerTable">
          <thead>
            <tr>
              <th>Identificador</th>
              <th>Nombre de usuario</th>
              <th>Contraseña</th>
              <th>Nombre</th>
              <th>Apellido</th>
              <th>Correo</th>
            </tr>
          </thead>
          <tbody id="customerTableBody">
            <!-- Aquí se insertarán las filas dinámicamente -->
          </tbody>
        </table>
      </div>
      <div>
        <!-- formulario de eliminar -->
        <h2>Eliminar cliente</h2>
        <form id="deleteForm">
          <!-- <label>ID: <input type="number" name="id" required /></label><br /> -->
          <label>ID: <select id="deleteIdSelect" name="id" required><option value="">Seleccione un cliente</option></select></label><br />
          <button type="submit">Eliminar Cliente</button>
        </form>
      </div>
    </div>

    <div class="form-container">
      <div>
        <!-- formulario de crear -->
        <h2>Crear nuevo cliente</h2>
        <form id="createForm">
          <label>Nombre de usuario: <input type="text" name="username" required /></label><br />
          <label>Contraseña: <input type="text" name="password" required /></label><br />
          <label>Nombre: <input type="text" name="name" required /></label><br />
          <label>Apellido: <input type="text" name="lastname" required /></label><br />
          <label>Correo: <input type="email" name="email" required /></label><br />
          <button type="submit">Crear Cliente</button>
        </form>
      </div>
      <div>
        <!-- formulario de actualizar -->
        <h2>Actualizar cliente</h2>
        <form id="updateForm">
          <label>ID: <select id="updateIdSelect" name="id" required><option value="">Seleccione un cliente</option></select></label><br />
          <label>Nombre de usuario: <input type="text" name="username" required /></label><br />
          <label>Contraseña: <input type="text" name="password" required /></label><br />
          <label>Nombre: <input type="text" name="name" required /></label><br />
          <label>Apellido: <input type="text" name="lastname" required /></label><br />
          <label>Correo: <input type="email" name="email" required /></label><br />
          <button type="submit">Actualizar Cliente</button>
        </form>
      </div>
    </div>



    <script>
      const baseUrl = 'http://localhost:8282/customers';

      function getAllCustomers() {
        fetch(baseUrl)
        .then(response => response.json())
        .then(data => {
          // Llenar tabla
          const tbody = document.getElementById('customerTableBody');
          tbody.innerHTML = '';
          //
          data.forEach(customer => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${customer.id}</td>
              <td>${customer.username}</td>
              <td>${customer.password}</td>
              <td>${customer.name}</td>
              <td>${customer.lastname}</td>
              <td>${customer.email}</td>
            `;
            tbody.appendChild(row);
          });
          // Llenar select de eliminación
          populateDeleteSelect(data);
        })
        .catch(error => alert('Error al obtener clientes: ' + error));
      }

      // función para poblar el select con los IDs existentes
      function populateDeleteSelect(customers) {
        const deleteSelect = document.getElementById('deleteIdSelect');
        const updateSelect = document.getElementById('updateIdSelect');
        deleteSelect.innerHTML = '<option value="">Seleccione un cliente</option>';
        updateSelect.innerHTML = '<option value="">Seleccione un cliente</option>';

        customers.forEach(c => {
          const option1 = document.createElement('option');
          option1.value = c.id;
          option1.textContent = `ID ${c.id} - ${c.username}`;
          deleteSelect.appendChild(option1);

          const option2 = document.createElement('option');
          option2.value = c.id;
          option2.textContent = `ID ${c.id} - ${c.username}`;
          updateSelect.appendChild(option2);
        });
      }

      document.getElementById('createForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const customer = Object.fromEntries(formData.entries());

        fetch(baseUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(customer)
        })
          .then(response => response.json())
          .then(data => {
            alert('Cliente creado con ID: ' + data.id);
            getAllCustomers();
          })
          .catch(error => alert('Error al crear cliente: ' + error));
      });

      document.getElementById('updateForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const id = formData.get('id');
        formData.delete('id');
        const customer = Object.fromEntries(formData.entries());

        fetch(`${baseUrl}/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(customer)
        })
          .then(response => {
            if (response.ok) {
              alert('Cliente actualizado');
              getAllCustomers();
            } else {
              alert('Error: cliente no encontrado');
            }
          })
          .catch(error => alert('Error al actualizar cliente: ' + error));
      });

      document.getElementById('deleteForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const id = new FormData(this).get('id');

        fetch(`${baseUrl}/${id}`, {
          method: 'DELETE'
        })
          .then(response => {
            if (response.status === 200)  {
              alert('Cliente ' + id + ' eliminado');
              getAllCustomers();
            } else {
              alert('cliente no encontrado');
            }
          })
          .catch(error => alert('Error al eliminar cliente: ' + error));
      });

    </script>

  </body>

</html>